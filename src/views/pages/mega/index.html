<!DOCTYPE html>
<html lang="es-MX">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dise침o Mejorado</title>
    <link rel="stylesheet" href="../../assets/mega/assets/css/style.css">
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- Owl Carousel CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css">
</head>

<body>
    <div class="top-bar">
        <div class="location">
            <p><span>游늸 ABASOLO</span></p>
        </div>
        <div class="sales-info">
            <p>VENTAS: 33 9690 1234</p>
        </div>
        <div class="account-actions">
            <button class="account-btn">Mi cuenta</button>
            <button class="pay-btn">Pago en l칤nea</button>
        </div>
    </div>

    <!-- popup -->
    <div class="popup" id="location-popup">
        <div class="popup-content">
            <span class="close-popup">X</span>
            <h3>Si deseas cambiar tu ubicaci칩n, selecciona una opci칩n de esta lista</h3>
            <select id="location-select">
                <option value="Abasolo">Abasolo</option>
                <option value="Guadalajara">Guadalajara</option>
                <option value="Zapopan">Zapopan</option>
                <option value="Tlaquepaque">Tlaquepaque</option>
            </select>
            <button id="confirm-location">Cambiar</button>
        </div>
    </div>

    <!-- menu-->
    <header>
        <div class="logo">
            <a href="index.html">
                <img src="../../assets/mega/assets/img/mega-logo.png" alt="Logo">
            </a>
        </div>
        <nav class="menu">
            <ul>
                <li><a href="canales.html">Canales</a></li>
                <li><a href="cis.html">CIS</a></li>
                <li><span><a href="#">Xview+</a></span></li>
                <li><a href="#">Streaming</a></li>
                <li><a href="#">Premier</a></li>
                <li><a href="#">Ayuda</a></li>
            </ul>
        </nav>
        <div class="hamburger-menu">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </header>

    <!-- banner -->
    <section class="banner">
        <img src="../../assets/mega/assets/img/banner-01.webp" alt="Imagen de banner">
    </section>

    <!-- menu movil -->
    <div class="mobile-menu">
        <span class="close-btn">X</span>
        <ul>
            <li><a href="canales.html">Canales</a></li>
            <li><a href="cis.html">CIS</a></li>
            <li><a href="#">Xview+</a></li>
            <li><a href="#">Streaming</a></li>
            <li><a href="#">Premier</a></li>
            <li><a href="#">Ayuda</a></li>
            <li><a href="#">Mi cuenta</a></li>
            <li><a href="#">Pago en l칤nea</a></li>
        </ul>
    </div>

    <!-- ********** Paquetes ********** -->
    <section class="container">
        <div class="owl-carousel owl-theme" id="carousel-packages">
            <div id="card-container"></div> <!-- Contenedor para las tarjetas -->
        </div>
    </section>

    <!-- ********** Scripts ********** -->

    <!-- Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- Owl Carousel JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
    <script src="../../assets/mega/assets/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Fetch para obtener las sucursales
            fetch('/mega/data')
                .then(response => response.json())
                .then(data => {
                    const slcOptions = document.getElementById('location-select');
                    slcOptions.innerHTML = ''; // Limpiar el contenido existente
                    data.forEach(item => {
                        const option = document.createElement('option');
                        option.value = item.idSucursal;
                        option.textContent = item.sucursalName;
                        slcOptions.appendChild(option);
                    });
    
                    // Cargar las tarjetas para la primera sucursal en la lista
                    if (data.length > 0) {
                        cardTarifario(data[0].idSucursal);
                    }
                })
                .catch(error => console.error('Error al cargar los datos de las sucursales:', error));
    
            // Funci칩n para cargar las tarjetas del tarifario
            function cardTarifario(idSucursal) {
                console.log(`Cargando tarifario para la sucursal: ${idSucursal}`);
                // Fetch para obtener los datos de la API
                fetch(`/api/tarifario/${idSucursal}`)
                    .then(response => response.json())
                    .then(data => {
                        console.log('Datos del tarifario:', data);
                        const container = document.getElementById('card-container'); // Contenedor donde se agregar치n las tarjetas
                        container.innerHTML = ''; // Limpiar el contenido existente
    
                        data.forEach(item => {
                            // Crear la estructura de la tarjeta
                            const card = document.createElement('div');
                            card.className = 'item card_pack';
    
                            card.innerHTML = `
                                <div class="promo_megas">
                                    <h4>${item.fibraOptica ? 'Fibra 칍ptica' : 'Cable'}</h4>
                                    <h4>${item.velocidadInternet} MBPS</h4>
                                </div>
                                <div class="xview-container">
                                    <img src="../../assets/mega/assets/img/xview-logo.png" alt="">
                                </div>
                                <div class="beneficios-pack">
                                    <ul>
                                        <li>${item.telefonia}</li>
                                        <li>${item.precioPromoPaquete}</li>
                                        <li>${item.precioNormalPaquete}</li>
                                        <li>${item.simetria}</li>
                                    </ul>
                                </div>
                                <div class="promo_partners">
                                    <img src="../../assets/mega/assets/img/promo-partner.png" alt="">
                                </div>
                                <div class="package_price">
                                    <p class="price-pack">${item.tarifaPromocional}</p>
                                    <p class="payment-time"> / AL MES</p>
                                </div>
                            `;
    
                            // Agregar la tarjeta al contenedor
                            container.appendChild(card);
                        });
    
                        // Inicializar el carrusel de Owl Carousel despu칠s de agregar las tarjetas
                        $('#carousel-packages').owlCarousel({
                            loop: true,
                            margin: 10,
                            nav: true,
                            responsive: {
                                0: {
                                    items: 1
                                },
                                600: {
                                    items: 2
                                },
                                1000: {
                                    items: 3
                                }
                            }
                        });
                    })
                    .catch(error => console.error('Error al cargar los datos del tarifario:', error));
            }
    
            // Evento para cambiar la sucursal y cargar las tarjetas correspondientes
            document.getElementById('location-select').addEventListener('change', function() {
                const idSucursal = this.value;
                cardTarifario(idSucursal);
            });
        });
    </script>
</body>

</html>